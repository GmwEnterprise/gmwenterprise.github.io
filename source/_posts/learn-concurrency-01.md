---
title: 学习Java并发（01）基本概念
date: 2019-12-31 11:33:06
categories: 并发
tags:
  - java
  - concurrency
---
## 前言

在工作中时常接触到并发环境，只是现有的框架已经在底层封装好了，可以直接调用。但总会有一些奇特的场景需要自己手动实现并发，所以了解原理是很重要的。本文用于记录学习并发过程中重要的点或思考。

## 开始记录

### 并发的含义

宏观来讲，并发指单个CPU在同一时间段可处理多个任务，而任一时刻只有一个任务正在处理。并发与**并行**这两个概念有区别，*并行是指两个或者多个事件在同一时刻发生；而并发是指两个或多个事件在同一时间间隔内发生*。对于现代计算机而言，基本上都是拥有多核心CPU的，所以从物理角度上能够实现所谓的并行计算；而并发无论是在单核还是多核环境都是可以实现的。

### java中的并发

大多数java代码其实都是所谓的**顺序编程**，即代码会从第一行逐行往下运行，其中的逻辑、变量等都是可控的。有些情况会需要并发处理，比如servlet接受请求返回响应，这就是一个天然的并发场景。而servlet容器（如tomcat）实际上已经内置了很好的并发模型支持，所以我们在写业务代码时大多不需要显示地处理并发请求。

### 进程与线程

#### 概念

> 进程（Process）是计算机中的程序关于某数据集合上的一次运行活动，是系统进行资源分配和调度的基本单位，是操作系统结构的基础。在早期面向进程设计的计算机结构中，进程是程序的基本执行实体；在当代面向线程设计的计算机结构中，进程是线程的容器。程序是指令、数据及其组织形式的描述，进程是程序的实体。
> 
> 线程（Thread）是操作系统能够进行运算调度的最小单位。它被包含在进程之中，是进程中的实际运作单位。一条线程指的是进程中一个单一顺序的控制流，一个进程中可以并发多个线程，每条线程并行执行不同的任务。
> 
> -- 摘自百度百科

进程是运行在它自己的地址空间内的自包容的程序。多任务操作系统可以周期性地将CPU从一个进程切换到另一个进程，来实现同时运行多个进程，且进程之间是互相隔离的，不会彼此干涉。而线程之间要共享资源例如内存、I/O等。所以多线程编程的难点就在于协调不同线程对于资源的访问，使其做到单个资源不会被多个线程同时访问继而造成一些奇怪的问题。

进程和线程是包含关系，但是多任务既可以由多进程实现，也可以由单进程内的多线程实现，还可以混合多进程＋多线程。

具体采用哪种方式，要考虑到进程和线程的特点。

和多线程相比，多进程的缺点在于：

- 创建进程比创建线程开销大，尤其是在Windows系统上；
- 进程间通信比线程间通信要慢，因为线程间通信就是读写同一个变量，速度很快。

而多进程的优点在于：

多进程稳定性比多线程高，因为在多进程的情况下，一个进程崩溃不会影响其他进程，而在多线程的情况下，任何一个线程崩溃会直接导致整个进程崩溃。

多数情况下，对于JVM而言，一个JVM只会启动一个进程。然而一个JVM进程可以容纳多个线程，所以Java的并发方式是多线程而不是多进程。

#### 在Windows中查看进程

其实直接在任务管理器中就可以查看到Windows系统所有的进程，且可以对其进行一些系统赋予的操作。
![20191231172225.png](https://i.loli.net/2019/12/31/vCOTqW12bM4iGrm.png)

多数程序，例如常见的Chrome、Firefox等都会启动多个进程，但数量不会太多。

#### 处理器与运行时线程的数量比例

1/N。

对于单核处理器而言，任何时刻只会有一个线程处于运行态。所以，哪怕有上千个线程，CPU也只会在任意时刻调用其中一个。然而实际场景中，CPU多为多核心，一台服务器通常拥有16到64核心，更甚者达到128核心，所以在这种多核环境下是可以实现同一时刻运行多个线程的。

### 线程的状态